var sylformats = [];
sylformats[0] = ["เAKียะ","เCRียะ","เXียะ","เAKาะ","AเKาะ","เCRาะ","เXาะ","เAKือะ","เCRือะ","เXือะ","เAKอะ","เCRอะ","เXอะ","เAKะ","เCRะ","เXะ","เXอ","AเKอY","เAKอY","เAKอ","AเKอ","เCRอY","เCRอ","เXอY","AเKิY","เAKิY","เCRิY","เXิY","เAKีย","เCRีย","เXีย","เXียตร","เAKียY","เCRียY","เXียY","เAKือ","เCRือ","เXือ","เAKือY","เCRือY","เXือY","เAKย","เCRย","เXย","AเK็Y","เAK็Y","เCR็Y","เX็Y","เAKา","AเKา","เCRา","เXา","แAKะ","แCRะ","แXะ","แAK็Y","AแK็Y","แCR็Y","แX็Y","โAKะ","โCRะ","โXะ","AKัวะ","CRัวะ","Xัวะ","AKัว","CRัว","Xัว","AKัY","CRัY","สCRัY","XัY","Xัตร","Xัติ","Xัฐิ","Xักร","AKือ","CRือ","Xือ","AKืZ","CRืZ","XืZ","Xิตร","Xิทธ","AKิY","AKิ","CRิ","CRิY","Xิ","XิY","AKี","AKีY","CRี","CRีY","สCRี","สCRีY","Xี","XีY","AKึ","AKึY","CRึ","CRึY","Xึ","XึY","AKุ","AKุY","CRุ","CRุY","Xุ","XุY","Xุตร","AKู","AKูY","CRู","CRูY","Xู","XูY","Xูตร","Xูติ","AKา","AKาY","CRา","สCRา","CRาY","สCRาY","Xา","XาY","Xาตร","AKำ","CRำ","Xำ","AKะ","CRะ","Xะ","AเK","เAK","AเKY","เAKY","เAKตร","เCR","เCRY","สเCR","สเCRY","เX","เXY","เXตร","AแK","แAK","AแKY","แAKY","แCR","แCRY","แX","แXY","แXตร","AไK","ไAK","ไCR","ไX","ไXย","AโK","AโKY","โAK","โAKY","สโCRY","โCR","โCRY","โX","โXY","โXตร","โXติ","ใX","ใหX","ใคร","ใกล","AKอ","CRอ","Xอ","XอY","AKอY","CRอY","สCRอ","สCRอY","AK็อY","CR็อY","X็อY","สCR็อY","AKวY","CRวY","XวY","AKรรY","XรรY","Xรร","AKร","Xร","Xฤ","XฤY","AKY","CRY","XY","Xัย","Xอย","Xาย"];
sylformats[1] = ["Aa 'Kia","CRia","Xia","Aa 'KO","Aa 'KO","CRO","XO","Aa 'KUa","CRUa","XUa","Aa 'K@","CR@","X@","Xa 'Ke","CRe","Xe","X@@","Aa 'K@@D","Aa 'K@@D","Aa 'K@@","Aa 'K@@","CR@@D","CR@@","X@@D","Aa 'K@@Y","Aa 'K@@Y","CR@@Y","X@@Y","Aa 'Kiia","CRiia","Xiia","Xiia","Aa 'KiiaY","CRiiaY","XiiaY","Aa 'KUUa","CRUUa","XUUa","Aa 'KUUaD","CRUUaD","XUUaD","Aa 'K@@j","CR@@j","X@@j","Aa 'KeY","Aa 'KeY","CReY","XeY","Aa 'Kaw","Aa 'Kaw","CRaw","Xaw","Aa 'Kx","CRx","Xx","Aa 'KxY","Aa 'KxY","CRxY","XxY","Aa 'Ko","CRo","Xo","Aa 'Kua","CRua","Xua","Aa 'Kuua","CRuua","Xuua","Aa 'KaY","CRaY","sa1'CRaY","XaY","Xa","Xa","Xa","Xak","Aa 'KUU","CRUU","XUU","Aa 'KUUZ","CRUUZ","XUUZ","Xi","Xi","Aa 'KiY","Aa 'Ki","CRi","CRiY","Xi","XiY","Aa 'Kii","Aa 'KiiY","CRii","CRiiY","sa1'CRii","sa1'CRiiY","Xii","XiiY","Aa 'KU","Aa 'KUD","CRU","CRUD","XU","XUD","Aa 'Ku","Aa 'KuY","CRu","CRuY","Xu","XuY","Xu","Aa 'Kuu","Aa 'KuuY","CRuu","CRuuY","Xuu","XuuY","Xuu","Xuu","Aa 'Kaa","Aa 'KaaY","CRaa","sa1'CRaa","CRaaY","sa1'CRaaY","Xaa","XaaY","Xaa","Aa 'Kam","CRam","Xam","Aa 'Ka","CRa","Xa","Aa 'Kee","Aa 'Kee","Aa 'KeeY","Aa 'KeeY","Aa 'Kee","CRee","CReeY","sa1'CRee","sa1'CReeY","Xee","XeeY","Xee","Aa 'Kxx","Aa 'Kxx","Aa 'KxxY","Aa 'KxxY","CRxx","CRxxY","Xxx","XxxY","Xxx","Aa 'Kaj","Aa 'Kaj","CRaj","Xaj","Xaj","Aa 'Koo","Aa 'KooY","Aa 'Koo","Aa 'KooY","sa1'CRooY","CRoo","CRooY","Xoo","XooY","Xoo","Xoo","Xaj","Xaj","khraj","klaj","Aa 'KOO","CROO","XOO","XOOY","Aa 'KOOY","CROOY","sa1'CROO","sa1'CROOY","Aa 'KOY","CROY","XOY","sa1'CROY","Aa 'KuuaY","CRuuaY","XuuaY","Aa 'KaY","XaY","Xan","Aa 'KOOn","XOOn","Xri","XriY","Aa 'KoZ","CRoZ","XoZ","XAi","Xoy","XaI"];

var conso = [];
conso[0] = ['ก','ข','ฃ','ค','ฅ','ฆ','ง','จ','ฉ','ฌ','ช','ซ','ศ','ษ','ส','ญ','ฎ','ด','ฏ','ต','ฐ','ฑ','ฒ','ถ','ท','ธ','ณ','น','บ','ป','ผ','ฝ','พ','ภ','ฟ','ม','ย','ร','ฤ','ฤๅ','ล','ฬ','ฦ','ฦๅ','ว','ห','ฮ','อ'];
conso[1] = ['k','kh','kh','kh','kh','kh','ng','tc','tch','tch','tch','s','s','s','s','j','d','d','t','t','th','th','th','th','th','th','n','n','b','p','ph','f','ph','ph','f','m','j','r','','','l','l','','','w','h','h',''];
conso[2] = ['k','kh','kh','kh','kh','kh','N','c','ch','ch','ch','s','s','s','s','y','d','d','t','t','th','th','th','th','th','th','n','n','b','p','ph','f','ph','ph','f','m','j','r','rue','rue','l','l','lue','lue','w','h','h',''];
conso[3] = ['k','k','k','k','k','k','N','t','','','t','t','t','t','t','n','t','t','t','t','t','t','t','t','t','t','n','n','p','p','','','p','p','p','m','y','n','','','n','n','','','w','','','o'];
var vowel = [];
vowel[0] = ['ะ','ั','า','ำ','ิ','ี','ึ','ื','ุ','ู','เ','แ','โ','ใ','ไ','็'];
vowel[1] = ['a','a','a','am','i','i','ue','ue','u','u','e','ae','o','Ai','Ai','or'];
vowel[2] = ['a','a','A:','@m','i','i','ue','u:','U','U:','ey','@:',' oU','aI','aI','or'];
var vowel_mix = [];
vowel_mix[0] = ['ัว','ัวะ','เย','เะ','เ็','เอะ','เอ','เิ','เา','เียะ','เีย','เือะ','เือ','ือ','แะ','แ็','โะ','เาะ','ไย','ัย','าย','อย','อ','ว'];
vowel_mix[1] = ['ua','ua','oei','e','e','oe','oe','oe','ao','ia','ia','uea','uea','ue','ae','ae','o','or','ai','ai','ai','oy','or','ua'];
vowel_mix[2] = ['U@','%U@','3y','e','@','V','3','3:','aU@','i@','i@','uea','uea','u:','a:','a:','o:','or','aI','aI','aI:','oy','or','U@'];
vowel_need_front = ['ะ','ั','า','ำ','ิ','ี','ึ','ื','ุ','ู','ฺ','ๅ','็'];
vowel_need_end = ['ั','ึ'];
vowel_always_front = ['เ','แ','โ','ใ','ไ'];
vowel_always_end = ['ะ','ฯ','ๆ','์'];
var wCR= [];
wCR[0] = ['กร','ขร','คร','ตร','ปร','พร','กล','ขล','คล','ปล','ผล','พล','กว','ขว','คว'];
wCR[1] = ['kr','kr','khr','tr','pr','phr','kl','kl','khl','pl','phl','phl','kw','kw','khw'];
var replacelist = [];
replacelist[0] = ['“','”','ฤๅ','ฦๅ','ตร์','ทร์','ดร์','ษณ์','ขณ์','จน์','ฉน์','ชน์','ฎร์','ทก์','ธน์','วน์','วร์','ษก์','สร์','ษมณ์','ณ.','บ่','ฤ','ม.ค.','ก.พ.','มี.ค.','เม.ย.','พ.ค.','มิ.ย.','ก.ค.','ส.ค.','ก.ย.','ต.ค.','พ.ย.','ธ.ค.','๐','๑','๒','๓','๔','๕','๖','๗','๘','๙','/','ฯ','ฯลฯ','ศรีนครินทร์','วิภาวดี','จุฬาภรณ์','สิรินธร','อุบลรัตน์','สุวรรณภูมิ','สยามนุสสติ','ทุ่งครุ','คีรีรัฐนิคม','รัฐนิคม','เฉลิมพระเกียรติ','เวียงแหง','โนนดินแดง','โป่งน้ำร้อน','โพทะเล','กระนวน','กระสัง','กรุงเทพมหานคร','ขามสะแกแสง','คลองหอยโข่ง','ควนกาหลง','คันนายาว','คำตากล้า','ฆ้องชัย','จอมทอง','ชื่นชม','ดอกคำใต้','ดอนมดแดง','ดินแดง','ท่าเรือ','นางรอง','บางคอแหลม','บางระกำ','บ้านธิ','ปักธงชัย','พระทองคำ','พระประแดง','พระพุทธบาท','ภูผาม่าน','มวกเหล็ก','มหาราช','ยะหา','ย่านตาขาว','ศรีเมืองใหม่','ศรีสัชนาลัย','สองพี่น้อง','สอยดาว','สามง่าม','สามชุก','สายบุรี','หนองแซง','สรรหา','ขรรค์','สรรค์','กรรโชก','กรรไกร','กรรภิรมย์','ครรไล','บรรจง','ชรรลุ','บรรดา','กรรชิง','กรรเชอ','กรรเช้า','กรรเลียง','บรรทม','บรรทัท','บรรทุก','บรรเทา','บรรเทือง','ครรลอง','ครรไล','ครรโลง','ภรรยา','บรรษัท','บรรยาย','บรรหาร','จรรยา','กรรมาธิการ','กรรม','ธรรม','วรรค','มรรค','ลรรพ','สรรพ','วรรษ','เวลา'];
replacelist[1] = ['','','ruu','luu','','','','','','','','','','','','','','','','','na ','boo ','ru ','mok ka raa khom ','kum phaa phan ','mii naa khom ','mee saa jon ','phruk sa phaa khom ','mi thu naa jon ','ka ra ka daa khom ','sing haa khom ','kan jaa jon ','tu laa khom ','phru sa ci kaa jon ','than  waa  khom ','0','1','2','3','4','5','6','7','8','9','tap ','pai jaan noj ','pai jaan jai ','srinagarindra','vibhavadi','chulabhorn','sirindhorn','ubolratana','suvarnabhumi','sayam manutsati','thung khru','khiri ratthanikhom','ratthanikhom','chaloem phra kiat','wiang haeng','non din daeng','pong nam ron','pho thale','kranuan','krasang','krung thep maha nakhon','kham sakae saeng','khlong hoi khong','khuan ka long','khan na yao','kham ta kla','khong chai','chom thong','chuen chom','dok kham tai','don mot daeng','din daeng','tha ruea','nang rong','bang kho laem','bang rakam','banthi','pak thong chai','phra thong kham','phra pradaeng','phra phutthabat','phu pha man','muak lek','maha rat','yaha','yan ta khao','si mueang mai','si satchanalai','song phi nong','soi dao','sam ngam','sam chuk','sai buri','nong saeng','สัน หา ','ขัน ','สัน ','กัน โชค ','กัน ไกร ','กัน ภิ รม ','คัน ไล ','บัน จง ','ชัน ลุ ','บัน ดา ','กัน ชิง ','กัน เชอ ','กัน เช้า ','กัน เลียง ','บัน ทม ','บัน ทัท ','บัน ทุก ','บัน เทา ','บัน เทือง ','คัน ลอง ','คัน ไล ','คัน โลง ','ภัน ยา ','บัน ษัท ','บัน ยาย ','บัน หาร ','จัน ยา ','กำ มา ธิ การ ','กำ ','ธำ ','วัค ','มัค ','ลับ ','สับ ','วัษ ','เว ลา'];

var tone = ['่','้','๊','๋'];

var chars;
var words = [];
var thevowels;
var slrwords = '', wstart = '', wvowel = '', wend = '', wtone = '', wformat = '';
var s0 = '', v0 = '', e0 = '', t0 = '', f0 = '';
var cindex = 0;
var possible_min = 0;
var possible_vowel = '';
var needcheck = false; // true for check
function thaisplit(sentence){
//chars = sentence.split("");
sentence = numreplace_rule(sentence);
chars = replace_rule(sentence+" ").split("");
var windex = 1;
while (cindex < chars.length){
(function () { // dummy function
	switch (windex) {
	case 1:
			// step1
		// find posible min
		possible_vowel = '';
		possible_min = 0;
		for ( var i =0; i < 4; i++){
			if (vowel[0].indexOf(chars[cindex+i]) > -1)	{
				if (vowel_mix[0].searchFor(possible_vowel.concat(chars[cindex+i])) > -1 ){
					possible_vowel = possible_vowel.concat(chars[cindex+i]);
					possible_min ++;
				
				} else {
					i = 10;
				}
			} 
			//else {
			//	if((['อ','ย','ว'].indexOf(chars[cindex+i]) > -1) && (possible_min > 1)){
			//		var temp_poss_vowel = possible_vowel.concat(chars[cindex+i]);
			//		if (vowel_mix[0].searchFor(temp_poss_vowel) > -1 ){
			//			possible_vowel = possible_vowel.concat(chars[cindex+i]);
			//			possible_min ++;
			//		} 
			//	}
				
				
			//} 
			
		}
	//	thevowels += "[["+ possible_min+ ":" + possible_vowel+ "]] ";
		// check repeat
			if(chars[cindex] == 'ๆ'){
				words.push(words[words.length-1]);
				slrwords = slrwords.concat(words[words.length-1]);
				slrwords = slrwords.concat(" ");
				wstart = ''; wvowel = ''; wend = ''; wtone = ''; wformat = '';
				s0 = ''; v0 = ''; e0 = ''; t0 = ''; f0 = '';
				cindex++;
				windex = 1;
				return;		
			}
			if(conso[0].indexOf2(chars[cindex]) > -1 ){
				
				//check next is not karan then skip			
				if(chars[cindex+1] == "์"){
					//not record
					finalword();
					wstart = ''; wvowel = ''; wend = ''; wtone = ''; wformat = '';
					s0 = ''; v0 = ''; e0 = ''; t0 = ''; f0 = '';
					windex = 1;
					cindex++;
					cindex++;
					return;
				}
				s0 = chars[cindex];
				wstart = s0;
				wformat = "X";				
			} else {
				
				if (vowel[0].indexOf(chars[cindex]) > -1 ){
				v0 = chars[cindex];
				wvowel = v0;
				wformat = chars[cindex];				
				} else {
					if (tone.indexOf(chars[cindex]) > -1 ){
						wtone = chars[cindex];
						cindex++;
						return;
					} else {
								slrwords = slrwords.concat(chars[cindex]);
								cindex++;
								windex = 1;
								return;
							}
				}
			}
			if (needcheck){
				alert('1windex:'+windex);
				alert('1char:'+chars[cindex]);
				alert('1wformat:'+wformat);					
			}
	
			cindex++;
			windex++;
			break;
	case 2:
			// step2
			if(conso[0].indexOf2(chars[cindex]) > -1 ){
				//check next is not karan then skip			
				if(chars[cindex+1] == "์"){
					//not record
					finalword();
					wstart = ''; wvowel = ''; wend = ''; wtone = ''; wformat = '';
					s0 = ''; v0 = ''; e0 = ''; t0 = ''; f0 = '';
					windex = 1;
					cindex++;
					cindex++;
					return;
				}
				
				if((chars[cindex] == 'ย' || chars[cindex] == 'อ' || chars[cindex] == 'ว') && (s0.length > 0) && (v0.length >= possible_min) && (['อ','ย','ว'].indexOf(v0) ==-1)){
					if(vowel_mix[0].searchFor(v0.concat(chars[cindex])) > -1){
					v0 = v0.concat(chars[cindex]);
					wvowel = v0;
					wformat = wformat.concat(chars[cindex]);
					cindex++;
					windex = 3;
					return;
					}
				}
				// check is CR or AK
				if(s0.length > 0){				
					if(wCR[0].indexOf((s0.concat(chars[cindex]))) > -1 ){
					s0 = s0.concat(chars[cindex]);
					wstart = s0;
					wformat = "CR";
					} else {
					s0 = s0.concat(chars[cindex]);
					wstart = s0;
					wformat = "AK";
					}
					
				} else {
					s0 = chars[cindex];
					wstart = s0;
					wformat = wformat.concat("X");	
				}

	
			} else {
				if (vowel[0].indexOf(chars[cindex]) > -1 ){
					
				/////
				if(vowel_always_front.indexOf(chars[cindex]) > -1){
					wvowel = 'ะ';
					wformat = wformat.concat(chars[cindex]);
					windex--;
					break;
				}
					
				v0 = v0.concat(chars[cindex]);
				wvowel = v0;
				wformat = wformat.concat(chars[cindex]);
				
				} else {
					if (tone.indexOf(chars[cindex]) > -1 ){
						wtone = chars[cindex];
						cindex++;
						return;
					} else {
								slrwords = slrwords.concat(chars[cindex]);
								cindex++;
								windex = 1;
								return;
							}
					}
				}
			if (needcheck){
				alert('2windex:'+windex);
				alert('2char:'+chars[cindex]);				
				alert('2wformat:'+wformat);					
			}
			cindex++;
			windex++;
			break;
	case 3:			
				
			// step3+
			while (true){
			
				if (tone.indexOf(chars[cindex]) < 0){
					if(check_complete()) {
						finalword();
						wstart = ''; wvowel = ''; wend = ''; wtone = ''; wformat = '';
						s0 = ''; v0 = ''; e0 = ''; t0 = ''; f0 = '';
						windex = 1;
						return;
					}
				} 
				if((chars[cindex] == 'ย' || chars[cindex] == 'อ' || chars[cindex] == 'ว') && (s0.length > 0) && (v0.length >= possible_min) && (['อ','ย','ว'].indexOf(v0) ==-1)){
					if (vowel_mix[0].searchFor(v0.concat(chars[cindex])) > -1){
						v0 = v0.concat(chars[cindex]);
						wvowel = v0;
						wformat = wformat.concat(chars[cindex]);
						cindex++;
						return;	
					}
				}
				
				if(conso[0].indexOf2(chars[cindex]) > -1 ){
					//check next is not karan then skip			
					if(chars[cindex+1] == "์"){
						//not record
						finalword();
						wstart = ''; wvowel = ''; wend = ''; wtone = ''; wformat = '';
						s0 = ''; v0 = ''; e0 = ''; t0 = ''; f0 = '';
						windex = 1;
						cindex++;
						cindex++;
						return;
					}
					// check is CR or AK
					if((s0.length == 1) && (wformat.slice(-1)=="X") && (wtone.length==0) && (vowel[0].indexOf(chars[cindex-1]) < 0)){
						if(wCR[0].indexOf((s0.concat(chars[cindex]))) > -1 ){
						s0 = s0.concat(chars[cindex]);
						wstart = s0;
						wformat = wformat.substr(0,wformat.length-1).concat("CR");
						} else {
						s0 = s0.concat(chars[cindex]);
						wstart = s0;
						wformat = wformat.substr(0,wformat.length-1).concat("AK");
						}
						
					} else {
						e0 = e0.concat(chars[cindex]);
						wend = e0;
						wformat = wformat.concat("Y");
						// it is complete when have "Y"
						finalword();
						wstart = ''; wvowel = ''; wend = ''; wtone = ''; wformat = '';
						s0 = ''; v0 = ''; e0 = ''; t0 = ''; f0 = '';
						windex = 1;
						cindex++;
						return;
					}

		
				} else {
					
					if (vowel[0].indexOf(chars[cindex]) > -1 ){
					v0 = v0.concat(chars[cindex]);
					wvowel = v0;
					wformat = wformat.concat(chars[cindex]);
					} else {
						if (tone.indexOf(chars[cindex]) > -1 ){
							wtone = chars[cindex];
							cindex++;
							return;
						} else {
									slrwords = slrwords.concat(chars[cindex]);
									cindex++;
									return;
								}
						}
					}
				
				
				if (needcheck){
					alert('3windex:'+windex);
					alert('3char:'+chars[cindex]);
					alert('3wformat:'+wformat);	
				}
				cindex++;
			}
			break;

	}
	}()); // enddummy function for return
}
	
// document.write(thevowels);
	return slrwords;
}

function replace_rule(s){
for ( var i=0; i < replacelist[0].length;i++)	{
	s = s.replace(replacelist[0][i],replacelist[1][i]);
	}
return s;
}

function formatchar(charnum){
	thecode = chars[charnum];
	if (typeof chars[charnum] == "undefined" ){
		return "";	
	}
	if(conso[0].indexOf2(thecode) > -1 ){
		if((thecode == 'ย' || thecode == 'อ' || thecode == 'ว') && (s0.length > 0)){
			return thecode;
		} else {
			return "Y";	
		}			

	} else {
		if (vowel[0].indexOf(thecode) > -1 ){
		return thecode;
		
		} else {
			if (tone.indexOf(thecode) > -1 ){
				return formatchar(charnum+1);
			} else {
				if( ["ๆ"].indexOf(thecode) > -1)	{
					return thecode;
				}	else {
					return "";
				}
				
					}
			}
		}
}
function check_complete(){
	// test adding and check format
	var formatyes = false;
	if (needcheck){
		alert('chk_wformat:'+wformat);	
		alert('chk_ok:'+sylformats[0].searchFor(wformat));
		alert('chk_char:'+chars[cindex]);
	}

	if (sylformats[0].searchFor(wformat) > -1){formatyes = true;}
	if (vowel_always_front.indexOf(chars[cindex]) > -1){return true;}
	if ((tone.indexOf(chars[cindex+1]) > -1) && (wtone.length > 0)){return true;}
	//check excess vowel
	if ((vowel_need_front.indexOf(formatchar(cindex+1)) > -1) && (v0.replace('อ','').replace('ว','').replace('ย','').length >= possible_min) && (formatyes)){return true;}
	if(formatchar(cindex) == ""){return true;}
	if((chars[cindex] == 'ย' || chars[cindex] == 'อ' || chars[cindex] == 'ว') && (s0.length > 0) && (v0.length >= possible_min) && (['อ','ย','ว'].indexOf(v0) ==-1)){
			if (vowel_mix[0].searchFor(v0.concat(chars[cindex])) > - 1)  {
				var testformat = wformat.concat(chars[cindex]);
				if ((sylformats[0].searchFor(testformat) < 0) && (formatyes)){ return true;}
				return false;	
			}
			
		} 
	if(conso[0].indexOf2(chars[cindex]) > -1 ){
		// check is consonnt > 3 mean complete
		if (s0.concat(chars[cindex]).length > 3) { return true; }
		if((s0.length == 1) && (wformat.slice(-1)=="X") && (wtone.length==0) && (vowel[0].indexOf(chars[cindex-1]) < 0)){
			if (wCR[0].indexOf(s0.concat(chars[cindex])) > -1){
				var testformat = wformat.substr(0,wformat.length-1).concat("CR");
			} else {
				var testformat = wformat.substr(0,wformat.length-1).concat("AK");
			}
		} else {
			var testformat = wformat.concat("Y");
			if ((vowel_need_front.indexOf(formatchar(cindex+1)) > -1) && (formatyes)){return true;}
			if ((tone.indexOf(chars[cindex+1]) > -1) && (formatyes)){return true;}
			if((formatchar(cindex+1) !== "") && (formatchar(cindex+2) == "") && (formatyes)){return true;}
			if((formatchar(cindex+1) == "Y") && (vowel_need_front.indexOf(formatchar(cindex+2)) < 0) && (vowel_need_end.indexOf(formatchar(cindex-1)) < 0) && (formatyes)){return true;}
	
		}
		if ((sylformats[0].searchFor(testformat) < 0) && (formatyes)){ return true;}
		} else {
		
		if (vowel[0].indexOf(chars[cindex]) > -1 ){
		// check vowel have to be in vowel_mix array ?
			if (v0.concat(chars[cindex]).length > 1) {
				if (vowel_mix[0].searchFor(v0.concat(chars[cindex])) < 0) { return true; }
			}	
		//	alert(sylformats[0].searchFor(wformat.concat(chars[cindex])));
			if ((sylformats[0].searchFor(wformat.concat(chars[cindex])) < 0) && (formatyes)){ return true;}	
		} else {
			if (tone.indexOf2(chars[cindex]) > -1 ){
				// do nothing
			} else {
					//	do nothing
						return true;
					}
		}
	}
	return false;
}
function finalword(){
	if (needcheck){
		alert("wstart:"+wstart);	
		alert("wvowel:"+wvowel);	
		alert("wend:"+wend);
	}
	// find tone
	
//	var ntone = ['33','11','53','55','35'];
//	var otone =	['35','11','53','33','33'];
	var ntone = ['','11','51','55','214'];
	var otone =	['214','11','51','',''];
//	var ntone = ['','','','',''];
//	var otone =	['','','','',''];
	if (wstart.length >1){
		var toneswitch = wstart.slice(1,2);
	} else {
		var toneswitch = wstart.slice(0,1);
	}	
	switch(toneswitch){
	case 'ก':
	case 'จ':
	case 'ด':
	case 'ต':
	case 'ฎ':
	case 'ฏ':
	case 'บ':
	case 'ป':
	case 'อ':
		var ctone = ntone[tone.indexOf(wtone) +1];
		break;
	default:
		var ctone = otone[tone.indexOf(wtone) +1];
	}
	
	
	if(wstart.length == 2 && wformat.length == 2){
		var cstart =  conso[2][conso[0].indexOf2(wstart.slice(0,1))];
		var cvowel = "o";
		var cend = conso[2][conso[0].indexOf2(wstart.slice(1,2))];
		var aword = "[["+cstart + cvowel + cend  +ctone + "]]";
//		alert("aword:"+aword);
		words.push(aword);
		slrwords = slrwords.concat(aword);
		slrwords = slrwords.concat(" ");
		return;
	}
	if((wstart.length > 1) && (wstart.slice(1,2) == 'อ') && (wvowel.length == 0)) {
		wstart = wstart.slice(0,1);
		wvowel = 'อ';
		
	}
	if(wstart.length > 1) {
		if ((typeof wend == "undefined" || wend == "") && (wformat.slice(-1) == "K")) {
			var cstart =  conso[2][conso[0].indexOf2(wstart.slice(0,1))];
			wend =  wstart.slice(1,2);

		} else {

			if(wCR[0].indexOf2(wstart) > -1){
				var cstart = wCR[1][wCR[0].indexOf(wstart)];
			} else {
				switch(wstart.slice(0,1)){
				case 'ห':
					var cstart =  conso[2][conso[0].indexOf2(wstart.slice(1,2))];
					break;
				case 'ท':
					if (wstart == "ทร") { var cstart =  conso[2][conso[0].indexOf2("ซ")]; }
					break;
				case 'อ':
					if (wstart == "อย") { var cstart =  conso[2][conso[0].indexOf2("ย")]; 
					} else {
					var cstart =  conso[2][conso[0].indexOf2(wstart.slice(0,1))] + "a "+ conso[2][conso[0].indexOf2(wstart.slice(1,2))];
					}
					break;
				case 'ข':
				case 'ฃ':
				case 'ฉ':
				case 'ฐ':
				case 'ถ':
				case 'ผ':
				case 'ฝ':
				case 'ส':
				case 'ษ':
				case 'ศ':
					var cstart =  conso[2][conso[0].indexOf2(wstart.slice(0,1))] + "a "+ conso[2][conso[0].indexOf2(wstart.slice(1,2))];
					break;
				default:
					if(['ร','ล'].indexOf(wstart.slice(1,2)) > -1){
						var cstart =  conso[2][conso[0].indexOf2(wstart.slice(0,1))];
					} else {
						var cstart =  conso[2][conso[0].indexOf2(wstart.slice(0,1))] + "a "+ conso[2][conso[0].indexOf2(wstart.slice(1,2))];	
					}
					
				}
			
			}
		}
	} else {
		var cstart = conso[2][conso[0].indexOf2(wstart)];
	}
	

	if ((wvowel.length > 1)|| (wvowel == 'อ') || (wvowel == 'ว')){
		var cvowel = vowel_mix[2][vowel_mix[0].indexOf(wvowel)];
	} else {
		var cvowel = vowel[2][vowel[0].indexOf(wvowel)];
	}
	
	
	if(typeof cvowel == "undefined") { cvowel = "o"};
	var cend = conso[3][conso[0].indexOf2(wend)];
	if (needcheck){
		alert("cstart:"+cstart);	
		alert("cvowel:"+cvowel);	
		alert("cend:"+cend);
	}
	if(typeof cend == "undefined") { cend = ""};
	//var aword = "[[" + cstart + cvowel + ctone + cend +"]]";
	var aword = "[["+cstart + cvowel + cend  +ctone + "]]";
	if (needcheck){
		alert("aword:"+aword);
	}
	if(typeof cstart !== "undefined") {
	words.push(aword);
	slrwords = slrwords.concat(aword);
	slrwords = slrwords.concat(" ");
	}
}

if (!Array.prototype.indexOf2)
{
  Array.prototype.indexOf2 = function(elt /*, from*/)
  {
    var len = this.length >>> 0;

    var from = Number(arguments[1]) || 0;
    from = (from < 0)
         ? Math.ceil(from)
         : Math.floor(from);
    if (from < 0)
      from += len;

    for (; from < len; from++)
    {
      if (from in this &&
          this[from] === elt)
        return from;
    }
    if (elt == 'ค') return 3;
    if (elt == 'จ') return 7;
    if (elt == 'ฉ') return 8;
    if (elt == 'ญ') return 15;
    if (elt == 'บ') return 28;
    if (elt == 'ป') return 29;
    return -1;
  };
}
Array.prototype.searchFor = function(candid) {
    for (var i=0; i<this.length; i++)
        if (this[i].indexOf(candid) == 0)
            return i;
    return -1;
};

Array.prototype.search2Begin = function(candid) {
	var len = candid;
    for (var i=0; i<this.length; i++)
        if (this[i].slice(0,len).indexOf(candid) == 0)
            return i;
    return -1;
};


function numinWords (num) {
//	var a = ['','one ','two ','three ','four ', 'five ','six ','seven ','eight ','nine ','ten ','eleven ','twelve ','thirteen ','fourteen ','fifteen ','sixteen ','seventeen ','eighteen ','nineteen '];
//	var b = ['', '', 'twenty','thirty','forty','fifty', 'sixty','seventy','eighty','ninety'];
//	var a = ['','หนึ่ง ','สอง ','สาม ','สี่ ', 'ห้า ','หก ','เจ็ด ','แปด ','เก้า ','สิบ ','สิบเอ็ด ','สิบสอง ','สิบสาม ','สิบสี่ ','สิบห้า ','สิบหก ','สิบเจ็ด ','สิบแปด ','สิบเก้า'];
//	var b = ['', '', 'ยี่สิบ','สามสิบ','สี่สิบ','ห้าสิบ', 'หกสิบ','เจ็ดสิบ','แปดสิบ','เก้าสิบ'];
	var a = ['','หนึ่ง ','สอง ','สาม ','สี่ ', 'ห้า ','หก ','เจ็ด ','แปด ','เก้า ','สิบ ','สิบ เอ็ด ','สิบ สอง ','สิบ สาม ','สิบ สี่ ','สิบ ห้า ','สิบ หก ','สิบ เจ็ด ','สิบ แปด ','สิบ เก้า'];
	var b = ['', '', 'ยี่ สิบ','สาม สิบ','สี่ สิบ','ห้า สิบ', 'หก สิบ','เจ็ด สิบ','แปด สิบ','เก้า สิบ'];
	
    if ((num = num.toString()).length > 9) return 'overflow';
    n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
    if (!n) return; var str = '';
    str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'สิบ ล้าน ' : ''; // 'crore '
    str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'แสน ' : ''; // 'lakh '
    str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'พัน ' : ''; // 'thousand '
    str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'ร้อย' : ''; // 'hundred '
//    str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'only ' : '';
    str += (n[5] != 0) ? ((str != '') ? ' ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + '' : '';
    return str;
}

function numreplace_rule(text){
	var r = /\d+/g;
//	var found = [];
	var m;
	while ((m = r.exec(text)) != null) {
	// alert(m[0]);
	text = text.replace(m[0],numinWords(m[0]));
	}
return text;	
}